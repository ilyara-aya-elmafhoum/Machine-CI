# 1. Créer le groupe github-runner
- name: Créer le groupe github-runner
  group:
    name: github-runner
    state: present
  become: yes

# 2. Créer l'utilisateur github-runner
- name: Créer l'utilisateur github-runner
  user:
    name: github-runner
    shell: /bin/bash
    create_home: yes
    group: github-runner
  become: yes

# 3. Créer le dossier runner
- name: Créer dossier GitHub Runner
  file:
    path: /opt/github-runner
    state: directory
    mode: '0755'
  become: yes

# 4. Télécharger le GitHub Runner (sans owner/group)
- name: Télécharger GitHub Runner
  get_url:
    url: https://github.com/actions/runner/releases/download/v2.308.0/actions-runner-linux-x64-2.308.0.tar.gz
    dest: /opt/github-runner/actions-runner-linux-x64.tar.gz
    mode: '0644'
  become: yes

# 5. Changer le propriétaire après téléchargement
- name: Changer propriétaire du dossier GitHub Runner
  file:
    path: /opt/github-runner
    owner: github-runner
    group: github-runner
    recurse: yes
  become: yes
